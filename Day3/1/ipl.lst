     1                                  ;har1-b0OS-ipl
     2                                  ; TAB=4
     3                                  
     4                                  CYLS		EQU		10
     5                                  		ORG		0x7c00		;
     6                                  ;
     7                                  
     8 00000000 EB46                    		JMP		entry
     9 00000002 90                      		DB		0x90
    10 00000003 484152312D42306970-     		DB		"HAR1-B0ipl"		;ブートセクタの名前
    10 0000000C 6C                 
    11 0000000D 0002                    		DW		512			;1セクタの大きさ
    12 0000000F 01                      		DB		1			;FAT開始場所
    13 00000010 02                      		DB		2			;FATの個数
    14 00000011 E000                    		DW		224			;ルートディレクトリ領域の大きさ
    15 00000013 400B                    		DW		2880			;ドライブの大きさ
    16 00000015 F0                      		DB		0xf0			;メディアタイプ
    17 00000016 0900                    		DW		9			;FAT領域の長さ
    18 00000018 1200                    		DW		18			;1トラックにあるセクタの数
    19 0000001A 0200                    		DW		2			;ヘッド数
    20 0000001C 00000000                		DD		0			;パーティション
    21 00000020 000029                  		DB		0,0,0x29		;この値にする
    22 00000023 FFFFFFFF                		DD		0xffffffff		;ボリュームシリアル番号
    23 00000027 484152312D42304F53      		DB		"HAR1-B0OS"		;ディスクの名前
    24 00000030 464154313209            		DB		"FAT12	"		;フォーマットの名前
    25 00000036 <res 00000012>          		RESB	18				;7c50にするためにここを埋める
    25          ******************       warning: uninitialized space declared in .text section: zeroing
    26                                  
    27                                  ;プログラム本体
    28                                  
    29                                  entry:
    30 00000048 B80000                  		MOV		AX,0			;レジスタ初期化
    31 0000004B 8ED0                    		MOV		SS,AX
    32 0000004D BC007C                  		MOV		SP,0x7c00
    33 00000050 8ED8                    		MOV		DS,AX
    34                                  
    35                                  ;ディスクを読む
    36                                  
    37 00000052 B82008                  		MOV		AX,0x0820		;ここで計算式はes*16+bx
    38 00000055 8EC0                    		MOV		ES,AX			;よって0x8200からになる。512バイトを読み込もうとしている
    39                                  							;0x8200~0x83ffを読みこむ
    40 00000057 B500                    		MOV		CH,0			;シリンダ0
    41 00000059 B600                            	MOV     	DH,0           		;ヘッド0
    42 0000005B B102                            	MOV		CL,2			;セクタ2
    43                                  
    44                                  readloop:
    45 0000005D BE0000                  		MOV		SI,0			;失敗回数を数えるレジスタ
    46                                  
    47                                  retry:							;INT13の設定を下でしている(JNCまで)
    48 00000060 B402                    		MOV		AH,0x02			;AH=0x02(読み込み) 
    49 00000062 B001                    		MOV		AL,1			;1セクタ
    50 00000064 BB0000                  		MOV		BX,0			
    51 00000067 B200                    		MOV		DL,0			;Aドライブ
    52 00000069 CD13                    		INT		0x13			;ディスクBIOS呼び出し
    53 0000006B 7310                    		JNC		next			;エラーにならなかったらfinへ
    54 0000006D 83C601                  		ADD		SI,1			;SIに1を足す
    55 00000070 83FE05                  		CMP		SI,5			;SIと5を比較
    56 00000073 732E                    		JAE		error			;SI>=5だったらerrorへ
    57 00000075 B400                    		MOV		AH,0x00			;(システムリセットに必要な操作)
    58 00000077 B200                    		MOV		DL,0x00			;Aドライブ(システムリセットに必要な操作)
    59 00000079 CD13                    		INT		0x13			;ドライブのリセット(システムリセットに必要な操作)
    60 0000007B EBE3                    		JMP		retry
    61                                  
    62                                  next:
    63 0000007D 8CC0                    		MOV		AX,ES			;開始位置(0x820)まで移動する(0x0820*16=0x8200)
    64 0000007F 83C020                  		ADD		AX,0x0020		;アドレスを0x200進める(0x0020*16=0x0200)(これによりメモリのアドレスを正しく表現できる)
    65                                  							;セクタを512/16=0x0020である。よってここではセクタに書いてある内容をメモリに展開している
    66 00000082 8EC0                    		MOV		ES,AX			;ADD ES,0x20という命令がないのでこのように表記
    67 00000084 80C101                  		ADD		CL,1			;CLに1を足す
    68 00000087 80F912                  		CMP		CL,18			;CLと18を比較
    69 0000008A 76D1                    		JBE		readloop		;CL<=18だったらreadloopへ
    70 0000008C B101                    		MOV		CL,1
    71 0000008E 80C601                  		ADD		DH,1
    72 00000091 80FE02                  		CMP		DH,2
    73 00000094 72C7                    		JB		readloop		;DH<2だったらreadloopへ
    74 00000096 B600                    		MOV		DH,0
    75 00000098 80C501                  		ADD		CH,1
    76 0000009B 80FD0A                  		CMP		CH,CYLS
    77 0000009E 72BD                    		JB		readloop		;CH<CYLSだったらreadloop
    78                                  
    79                                  ;読み終わった後の処理
    80                                  
    81                                  fin:
    82 000000A0 F4                      		HLT						;何かあるまでCPUを停止させる
    83 000000A1 EBFD                    		JMP		fin				;無限ループ
    84                                  
    85                                  error:
    86 000000A3 BE[B800]                		MOV		SI,msg
    87                                  putloop:
    88 000000A6 8A04                    		MOV		AL,[SI]
    89 000000A8 83C601                  		ADD		SI,1			;SIに1を足す
    90 000000AB 3C00                    		CMP		AL,0
    91 000000AD 74F1                    		JE		fin
    92 000000AF B40E                    		MOV		AH,0x0e			;一文字表示ファンクション
    93 000000B1 BB0F00                  		MOV		BX,15			;カラーコード
    94 000000B4 CD10                    		INT		0x10			;ビデオBIOS呼び出し
    95 000000B6 EBEE                    		JMP		putloop
    96                                  msg:
    97 000000B8 0A0A                    		DB		0x0a,0x0a		;改行を2つ
    98 000000BA 6C6F6164206572726F-     		DB		"load error"
    98 000000C3 72                 
    99 000000C4 0A                      		DB		0x0a			;改行
   100 000000C5 00                      		DB		0
   101                                  
   102 000000C6 <res 00000138>          		RESB	0x7dfe-0x7c00-($-$$)		;0x1efまでを0x00で埋める命令
   102          ******************       warning: uninitialized space declared in .text section: zeroing
   103                                  
   104 000001FE 55AA                    		DB		0x55,0xaa		;BS BootSign
   105                                  
   106                                  ;コメント
   107                                  ;１枚のディスクには80シリンダ
   108                                  ;ヘッド２つ
   109                                  ;18セクタで１セクタ512バイト
   110                                  ;0x7c00はブートセクタを読み込むためのプログラムが格納されているメモリの開始位置
   111                                  ;0x8000からブートセクタを書く(0x8000~0x81ffまで)
   112                                  ;ここの例では0x8200から読んでいる（あくまでシリンダを読むだけで内容が入っていない）
   113                                  ;このあとのOSの本体は0x4200を0x8000に足した場所から読み込まれる(0xc200から書いてある)
   114                                  ;0x8200から0xc200まではOSのメタデータが入っている
